# ×××’×¨ ×¤×¡×§×™ ×“×™×Ÿ - ××“×¨×™×š ×œ××¤×ª×—×™×

## ×ª×•×›×Ÿ ×¢× ×™×™× ×™×
1. [×¡×§×™×¨×” ×›×œ×œ×™×ª](#×¡×§×™×¨×”-×›×œ×œ×™×ª)
2. [×˜×›× ×•×œ×•×’×™×•×ª](#×˜×›× ×•×œ×•×’×™×•×ª)
3. [××¨×›×™×˜×§×˜×•×¨×”](#××¨×›×™×˜×§×˜×•×¨×”)
4. [×¤×•× ×§×¦×™×•× ×œ×™×•×ª ××¨×›×–×™×ª](#×¤×•× ×§×¦×™×•× ×œ×™×•×ª-××¨×›×–×™×ª)
5. [××‘× ×” ×”×§×‘×¦×™×](#××‘× ×”-×”×§×‘×¦×™×)
6. [×§×•××¤×•× × ×˜×•×ª ×¢×™×§×¨×™×•×ª](#×§×•××¤×•× × ×˜×•×ª-×¢×™×§×¨×™×•×ª)
7. [×”×ª×§× ×” ×•×”×¨×¦×”](#×”×ª×§× ×”-×•×”×¨×¦×”)
8. [×¤×™×¦'×¨×™× ××ª×§×“××™×](#×¤×™×¦×¨×™×-××ª×§×“××™×)

---

## ×¡×§×™×¨×” ×›×œ×œ×™×ª

**×××’×¨ ×¤×¡×§×™ ×“×™×Ÿ** ×”×•× ××¤×œ×™×§×¦×™×™×ª ×•×•×‘ ××ª×§×“××ª ×œ× ×™×”×•×œ, ×¢×™×•×Ÿ ×•× ×™×ª×•×— ×¤×¡×§×™ ×“×™×Ÿ ×©×œ ×‘×™×ª ×“×™×Ÿ ×¨×‘× ×™. 
×”××¢×¨×›×ª ×××¤×©×¨×ª ×”×¢×œ××”, ×—×™×¤×•×©, ×¢×™×•×Ÿ ×•×§×™×©×•×¨ ×©×œ ×¤×¡×§×™ ×“×™×Ÿ ×¢× ××§×•×¨×•×ª ×ª×•×¨× ×™×™× ××¡×¤×¨×™×.

### ××˜×¨×•×ª ×”×¤×¨×•×™×§×˜
- **× ×™×”×•×œ ××¨×›×–×™** ×©×œ ×¤×¡×§×™ ×“×™×Ÿ ×¢× ××—×¡×•×Ÿ ××§×•××™ (localStorage)
- **×—×™×¤×•×© ××ª×§×“×** ×¢× ×¡×™× ×•×Ÿ ×œ×¤×™ ×§×˜×’×•×¨×™×•×ª
- **×§×™×©×•×¨ ××•×˜×•××˜×™** ×œ××§×•×¨×•×ª ×ª×•×¨× ×™×™× (×’××¨×, ×©×•×œ×—×Ÿ ×¢×¨×•×š, ×¡×¤×¨×™×)
- **×¢×¨×™×›×ª ×˜×§×¡×˜** ×¢× ×”×“×’×©×•×ª ×•×¦×‘×™×¢×”
- **× ×™×•×•×˜ ××™× ×˜×•××™×˜×™×‘×™** ×¢× ×¡×™×™×“×‘×¨×™× ×—×›××™×
- **×ª×¦×•×’×•×ª ××¨×•×‘×•×ª** (×¨×©×ª, ×˜×‘×œ×”, ×§×•××¤×§×˜, ×¨×©×™××”)

---

## ×˜×›× ×•×œ×•×’×™×•×ª

### Frontend Framework
- **React 18.3.1** - ×¡×¤×¨×™×™×ª UI ××•×“×¨× ×™×ª ×¢× Hooks
- **TypeScript 5.6.2** - ×©×¤×” ××•×§×œ×“×ª ×œ×‘×˜×™×—×•×ª ×§×•×“
- **React Router v6.28.0** - × ×™×”×•×œ × ×™×•×•×˜ ×•×¨××•×˜×™× ×’

### Build & Dev Tools
- **Vite 6.0.1** - ×›×œ×™ ×‘× ×™×™×” ××”×™×¨ ×¢× HMR
- **ESLint 9.13.0** - ×‘×“×™×§×ª ××™×›×•×ª ×§×•×“
- **PostCSS 8.4.47** - ×¢×™×‘×•×“ CSS ××ª×§×“×

### Styling
- **Tailwind CSS 3.4.14** - framework CSS utility-first
- **Custom Theme** - ×¦×‘×¢×™× ××•×ª×××™× (navy-900, gold-400, cream, mouse)
- **RTL Support** - ×ª××™×›×” ××œ××” ×‘×¢×‘×¨×™×ª

### Libraries
- **DOMPurify 3.2.0** - × ×™×§×•×™ HTML ××¡×•×›×Ÿ
- **lucide-react 0.460.0** - ××™×™×§×•× ×™× ××™× ×™××œ×™×™×
- **Sefaria API** - ×’×™×©×” ×œ××§×•×¨×•×ª ×ª×•×¨× ×™×™×

### Storage & State
- **localStorage** - ××—×¡×•×Ÿ ××§×•××™ ×©×œ ×¤×¡×§×™ ×“×™×Ÿ ×•×”×¢×“×¤×•×ª
- **React State** - × ×™×”×•×œ state ××§×•××™ ×¢× useState/useEffect
- **useRef** - ×’×™×©×” ×™×©×™×¨×” ×œ××œ×× ×˜×™×

---

## ××¨×›×™×˜×§×˜×•×¨×”

### ××‘× ×” ×›×œ×œ×™
```
src/
â”œâ”€â”€ components/        # ×§×•××¤×•× × ×˜×•×ª ×©×™××•×©×™×•×ª
â”œâ”€â”€ pages/            # ×¢××•×“×™× ×¨××©×™×™×
â”œâ”€â”€ types/            # ×”×’×“×¨×•×ª TypeScript
â””â”€â”€ utils/            # ×¤×•× ×§×¦×™×•×ª ×¢×–×¨
```

### ×–×¨×™××ª × ×ª×•× ×™×
1. **×˜×¢×™× ×”**: `App.tsx` ×˜×•×¢×Ÿ ×¤×¡×§×™ ×“×™×Ÿ ×-localStorage
2. **×¤×¨×¡×™× ×’**: `parsePsakFile` ×× ×ª×— ×§×‘×¦×™ HTML ×•××—×œ×¥ ××˜×-×“××˜×”
3. **××™× ×“×§×¡**: `buildSourceIndex` ×™×•×¦×¨ ××™× ×“×§×¡ ×©×œ ×›×œ ×”××§×•×¨×•×ª
4. **×ª×¦×•×’×”**: ×§×•××¤×•× × ×˜×•×ª ××§×‘×œ×•×ª ××ª ×”×¤×¡×§×™× ×“×¨×š props
5. **×©××™×¨×”**: ×›×œ ×©×™× ×•×™ × ×©××¨ ××•×˜×•××˜×™×ª ×‘-localStorage

### Design Patterns
- **Component Composition** - ×‘× ×™×™×ª UI ×××¨×›×™×‘×™× ×§×˜× ×™×
- **Custom Hooks** - ×œ×•×’×™×§×” ××©×•×ª×¤×ª (useEffect, useMemo)
- **Controlled Components** - ×˜×¤×¡×™× ×¢× state
- **Higher Order Components** - Sidebar ×¢× auto-hide

---

## ×¤×•× ×§×¦×™×•× ×œ×™×•×ª ××¨×›×–×™×ª

### 1. ×”×¢×œ××ª ×¤×¡×§×™ ×“×™×Ÿ
**×§×•×‘×¥**: `src/pages/Upload.tsx` + `src/utils/psakUtils.ts`

**××™×š ×–×” ×¢×•×‘×“**:
- ××©×ª××© ××¢×œ×” ×§×‘×¦×™ HTML
- `parsePsakFile` ×× ×ª×— ××ª ×”-HTML:
  - ××—×œ×¥ ××¡×¤×¨ ×¤×¡×§ ××”×›×•×ª×¨×ª/×§×•×‘×¥
  - ××–×”×” ×›×•×ª×¨×ª ×¨××©×™×ª
  - ×× ×§×” HTML ×¢× DOMPurify
  - ××—×œ×¥ ×§×˜×’×•×¨×™×•×ª ××˜×’×™× ××• ×ª×•×›×Ÿ
  - ××–×”×” ×•××§×©×¨ ××§×•×¨×•×ª (×’××¨×, ×©×•"×¢, ×¨××‘"×)
- ×‘×•×“×§ ×›×¤×™×œ×•×™×•×ª ×œ×¤×™ ××¡×¤×¨+×›×•×ª×¨×ª
- ×©×•××¨ ×‘-localStorage

**×¤×•×¨××˜ ××§×•×¨**:
```typescript
{
  id: string,          // UUID ×™×™×—×•×“×™
  number: number,      // ××¡×¤×¨ ×¤×¡×§
  title: string,       // ×›×•×ª×¨×ª
  content: string,     // HTML ×× ×•×§×”
  rawText: string,     // ×˜×§×¡×˜ ×’×•×œ××™
  categories: string[],
  references: Reference[],
  dateAdded: Date,
  summary: string
}
```

### 2. ×–×™×”×•×™ ××§×•×¨×•×ª ××•×˜×•××˜×™
**×§×•×‘×¥**: `src/utils/smartReferences.ts`

**×˜×›× ×•×œ×•×’×™×”**: Regex patterns + NLP ×‘×¡×™×¡×™

**××§×•×¨×•×ª × ×ª××›×™×**:
- **×’××¨×**: `×‘×‘× ×§×× ×“×£ ×‘ ×¢××•×“ ×`
- **×©×•×œ×—×Ÿ ×¢×¨×•×š**: `×—×•×©×Ÿ ××©×¤×˜ ×¡×™××Ÿ ×’`
- **×¨××‘"×**: `×”×œ×›×•×ª ×’× ×™×‘×” ×¤×¨×§ × ×”×œ×›×” ×‘`
- **××©× ×”**: `×‘×‘× ××¦×™×¢× ×¤×¨×§ ×‘ ××©× ×” ×’`
- **×¡×¤×¨×™×**: `×‘×¨××©×™×ª ×¤×¨×§ × ×¤×¡×•×§ ×`

**×ª×”×œ×™×š**:
```javascript
extractAllSources(text) â†’ [
  { type: 'gemara', source: '×‘×‘× ×§××:2:×', text: '...', position: {start, end} },
  { type: 'shulchan_aruch', source: '×—×•×´×:3', ... }
]
```

### 3. ××™× ×“×§×¡ ×—×›× (Smart Index)
**×§×•×‘×¥**: `src/pages/SmartIndex.tsx`

**××‘× ×” ×”×™×¨×¨×›×™**:
```
×’××¨×
  â”œâ”€ ×‘×‘× ×§××
  â”‚   â”œâ”€ ×“×£ ×‘ (3 ×¤×¡×§×™×)
  â”‚   â””â”€ ×“×£ ×’ (2 ×¤×¡×§×™×)
  â””â”€ ×©×‘×ª
×©×•×œ×—×Ÿ ×¢×¨×•×š
  â””â”€ ×—×•×©×Ÿ ××©×¤×˜
      â””â”€ ×¡×™××Ÿ ×’
```

**×¤×•× ×§×¦×™×•×ª**:
- `buildSourceIndex()` - ×‘×•× ×” ××‘× ×” ×”×™×¨×¨×›×™
- Group by type â†’ book â†’ chapter â†’ verse
- ××•× ×” ×›××” ×¤×¡×§×™× ××¦×˜×˜×™× ×›×œ ××§×•×¨
- ×œ×—×™×¦×” ×¢×œ ××§×•×¨ â†’ ×§×¤×™×¦×” ×œ×¤×¡×§ ×¢× highlight

### 4. ×¢××•×“ ×¤×¡×§ ×“×™×Ÿ ×¢× ×¡×™×™×“×‘×¨×™×
**×§×•×‘×¥**: `src/pages/PsakView.tsx`

**××¨×›×™×˜×§×˜×•×¨×” - 3 ××–×•×¨×™×**:

**×¡×™×™×“×‘×¨ ×©×××œ×™ - ×¢×¨×™×›×”** (`EditingSidebar.tsx`):
- ×¢×™×¦×•×‘ ×˜×§×¡×˜: B/I/U/S/XÂ²/Xâ‚‚
- 5 ×¦×‘×¢×™ ×”×“×’×©×” (×¨×§×¢)
- ×‘×—×™×¨×ª ×’×•×“×œ ×’×•×¤×Ÿ (14-24px)
- ×¨×™×•×•×— ×©×•×¨×•×ª (1.0-2.5)
- ×›×¤×ª×•×¨ ××™×¤×•×¡
- Auto-hide + Pin

**××–×•×¨ ××¨×›×–×™ - ×ª×•×›×Ÿ**:
- ×ª×•×›×Ÿ ×”×¤×¡×§ ×‘-HTML
- `contentEditable={true}` - × ×™×ª×Ÿ ×œ×¢×¨×™×›×”
- ×©××™×¨×ª ×”×¢×“×¤×•×ª ×¢×™×¦×•×‘ ×‘-localStorage
- Highlight ×©×œ ××§×•×¨×•×ª ×‘×œ×—×™×¦×” ××”××™× ×“×§×¡

**×¡×™×™×“×‘×¨ ×™×× ×™ - × ×™×•×•×˜** (`NavigationSidebar.tsx`):
- 3 ×˜××‘×™×:
  - **×¡×™×›×•×**: ×ª×§×¦×™×¨ ×”×¤×¡×§
  - **×ª×•×›×Ÿ ×¢× ×™×™× ×™×**: ×›×•×ª×¨×•×ª ××”-HTML
  - **××§×•×¨×•×ª**: ×¨×©×™××ª ××§×•×¨×•×ª ×¢× ×§×‘×•×¦×•×ª
- ×—×™×¤×•×© ×‘××§×•×¨×•×ª
- ×œ×—×™×¦×” â†’ × ×™×•×•×˜/×§×¤×™×¦×” ×œ××§×•×¨

**Auto-Hide Logic**:
```javascript
useEffect(() => {
  const handleMouseMove = (e) => {
    if (!leftSidebarPinned && e.clientX <= 50) 
      setLeftSidebarVisible(true);
    if (!rightSidebarPinned && e.clientX >= window.innerWidth - 50)
      setRightSidebarVisible(true);
  };
  window.addEventListener('mousemove', handleMouseMove);
}, []);
```

### 5. ×¤×•×¤××¤ ×¢×¨×™×›×” ×‘×‘×—×™×¨×ª ×˜×§×¡×˜
**×§×•×‘×¥**: `src/components/SelectionPopup.tsx`

**×˜×¨×™×’×¨**: `document.addEventListener('selectionchange')`

**×ª×›×•× ×•×ª**:
- ××•×¤×™×¢ **××¢×œ** ×”×˜×§×¡×˜ ×”× ×‘×—×¨ (×œ× ×¢×œ ×’×‘×™×•)
- ×¢×™×¦×•×‘ ×˜×§×¡×˜: 6 ×›×¤×ª×•×¨×™×
- 8 ×¦×‘×¢×™ ×¨×§×¢
- 6 ×¦×‘×¢×™ ×˜×§×¡×˜
- ×¤×¢×•×œ×•×ª: ×”×¢×ª×§, × ×§×” ×¢×™×¦×•×‘

**×—×™×©×•×‘ ××™×§×•×**:
```javascript
const rect = selection.getRangeAt(0).getBoundingClientRect();
const popupHeight = 280;
let top = rect.top - containerRect.top + scrollTop - popupHeight - 15;
if (top < 0) top = rect.bottom + 15; // Flip below if no space
```

**×¢×™×¦×•×‘**:
- ×¨×§×¢ ×œ×‘×Ÿ, ××¡×’×¨×ª mouse-400
- ×˜×§×¡×˜ ×–×”×‘
- ×—×¥ ×œ××˜×” ××¦×‘×™×¢ ×¢×œ ×”×˜×§×¡×˜

### 6. ×¢××•×“ ××§×•×¨×•×ª + Sefaria API
**×§×•×‘×¥**: `src/pages/SourceView.tsx`

**×–×¨×™××”**:
1. URL: `/source/:source` (encoded)
2. ×¤×¢× ×•×—: `gemara:×‘×‘× ×§××:2:×`
3. ×”××¨×” ×œ-Sefaria format: `Bava_Kamma.2a`
4. Fetch: `https://www.sefaria.org/api/texts/Bava_Kamma.2a`
5. ×§××©: ×©××™×¨×” ×‘-localStorage
6. Render: ×˜×§×¡×˜ ×¢×‘×¨×™ + ××™×“×¢ ×’×¨×¡×”

**×¡×™×™×“×‘×¨×™×**:
- ×©×××œ: ×¢×¨×™×›×” (×›××• ×‘×¤×¡×§)
- **×™××™×Ÿ**: ×¤×¡×§×™× ×§×©×•×¨×™× (×™×•×¦× ××§×¦×” ×”×¡×™×™×“×‘×¨ ×”×©×××œ×™!)

**×—×“×©× ×•×ª**: ×”×¡×™×™×“×‘×¨ ×”×™×× ×™ ×××•×§× `left: 64` (××—×¨×™ ×”×¡×™×™×“×‘×¨ ×”×©×××œ×™) ×‘××§×•× `right: 0`

### 7. ×¡×™×™×“×‘×¨ ×¨××©×™ ×¢× Auto-Hide
**×§×•×‘×¥**: `src/components/Sidebar.tsx`

**×¤×™×¦'×¨×™×**:
- **Auto-hide**: ××•×¡×ª×¨ ×›×‘×¨×™×¨×ª ××—×“×œ
- **Trigger**: ×¢×›×‘×¨ ×‘×§×¦×” ×™××™×Ÿ (50px) â†’ ×¤×ª×™×—×”
- **Pin button**: ğŸ“ ××¦××™×“, ğŸ“Œ ××‘×˜×œ
- **Dynamic margin**: `App.tsx` ××ª××™× ××ª `<main>` ×‘×”×ª××

**××¦×‘ ××•×¦××“**:
- Sidebar: `translate-x-0`
- Main: `mr-72` (288px)

**××¦×‘ ××•×¡×ª×¨**:
- Sidebar: `translate-x-full`
- Main: `mr-0`

### 8. ×ª×¦×•×’×•×ª ××¨×•×‘×•×ª + ×‘×—×™×¨×” ××¨×•×‘×”
**×§×•×‘×¥**: `src/pages/PsakimList.tsx`

**4 ××¦×‘×™ ×ª×¦×•×’×”**:

**Grid (â–¦)**: ×›×¨×˜×™×¡×™× 3 ×¢××•×“×•×ª
- ××ª××™× ×œ×¢×™×•×Ÿ ××”×™×¨
- ×ª××•× ×ª ××¦×‘ ×©×œ ×›×œ ×¤×¡×§

**Table (â–¤)**: ×˜×‘×œ×” ××¡×•×“×¨×ª
- ×¢××•×“×•×ª: ××¡×¤×¨, ×›×•×ª×¨×ª, ×§×˜×’×•×¨×™×•×ª, ×ª××¨×™×š, ×¤×¢×•×œ×•×ª
- ×©×•×¨×•×ª ××•×“×’×©×•×ª ×œ×¡×™×¨×•×’×™×Ÿ
- ×›×¤×ª×•×¨×™ ×¤×¢×•×œ×” ×‘×©×•×¨×”

**Compact (â–¥)**: 5 ×›×¨×˜×™×¡×™× ×‘×©×•×¨×”
- ×—×•×¡×š ××§×•×
- ×¨×§ ××™×“×¢ ×‘×¡×™×¡×™

**List (â˜°)**: ×©×•×¨×” ××—×ª ×œ×¤×¡×§
- ×ª×¦×•×’×” ×¦×¤×•×¤×”
- ××™×“×¢ ××œ× ×‘×©×•×¨×” ××—×ª

**×‘×—×™×¨×” ××¨×•×‘×”**:
- ×›×¤×ª×•×¨ "â˜‘ ×‘×—×™×¨×” ××¨×•×‘×”"
- Checkboxes ×¢×œ ×›×œ ×¤×¡×§
- "×‘×—×¨ ×”×›×œ" / "×‘×˜×œ ×”×›×œ"
- "××—×§ × ×‘×—×¨×™× (X)" ×¢× ××•× ×”
- ×¢×•×‘×“ ×‘×›×œ ××¦×‘×™ ×”×ª×¦×•×’×”!

**State Management**:
```typescript
const [viewMode, setViewMode] = useState<ViewMode>('grid');
const [selectionMode, setSelectionMode] = useState(false);
const [selectedIds, setSelectedIds] = useState<Set<string>>(new Set());
```

### 9. ×× ×™×¢×ª ×›×¤×™×œ×•×™×•×ª
**×§×•×‘×¥**: `src/App.tsx`

**×‘×”×¢×œ××”**:
```javascript
const isDuplicate = psakim.some(
  p => p.number === psak.number && p.title === psak.title
);
if (!isDuplicate) newPsakim.push(psak);
```

**×”×¡×¨×” ×™×“× ×™×ª**:
```javascript
handleRemoveDuplicates() {
  const seen = new Map();
  const unique = psakim.filter(p => {
    const key = `${p.number}-${p.title}`;
    if (seen.has(key)) return false;
    seen.set(key, true);
    return true;
  });
  setPsakim(unique);
}
```

---

## ××‘× ×” ×”×§×‘×¦×™×

### src/components/
- **Sidebar.tsx** - ×¡×™×™×“×‘×¨ ×¨××©×™ ×¢× auto-hide
- **EditingSidebar.tsx** - ×›×œ×™ ×¢×¨×™×›×” (×©×××œ)
- **NavigationSidebar.tsx** - × ×™×•×•×˜ ×•××§×•×¨×•×ª (×™××™×Ÿ)
- **SelectionPopup.tsx** - ×¤×•×¤××¤ ×¢×¨×™×›×” ×‘×‘×—×™×¨×ª ×˜×§×¡×˜

### src/pages/
- **App.tsx** - ×¨×•×˜ ×§×•××¤×•× × ×˜, × ×™×”×•×œ state ×¨××©×™
- **Dashboard.tsx** - ×¢××•×“ ×‘×™×ª ×¢× ×¡×˜×˜×™×¡×˜×™×§×•×ª
- **PsakimList.tsx** - ×¨×©×™××ª ×¤×¡×§×™× ×¢× 4 ×ª×¦×•×’×•×ª
- **PsakView.tsx** - ×¢××•×“ ×¤×¡×§ ×‘×•×“×“ ×¢× ×¡×™×™×“×‘×¨×™×
- **Upload.tsx** - ×”×¢×œ××ª ×§×‘×¦×™×
- **SourceView.tsx** - ×ª×¦×•×’×ª ××§×•×¨ ××¡×¤×¨×™×
- **SmartIndex.tsx** - ××™× ×“×§×¡ ×”×™×¨×¨×›×™ ×©×œ ××§×•×¨×•×ª
- **Connections.tsx** - ×’×¨×£ ×§×©×¨×™× ×‘×™×Ÿ ×¤×¡×§×™×
- **GemaraExplorer.tsx** - ×¡×™×•×¨ ×‘××¡×›×ª×•×ª
- **ShulchanAruchExplorer.tsx** - ×¡×™×•×¨ ×‘×©×•"×¢
- **SefarimExplorer.tsx** - ×¡×™×•×¨ ×‘×¡×¤×¨×™×

### src/types/
- **index.ts** - ×›×œ ×”×”×’×“×¨×•×ª:
```typescript
interface PsakDin {
  id: string;
  number: number;
  title: string;
  content: string;
  rawText: string;
  categories: string[];
  references: Reference[];
  dateAdded: Date;
  summary: string;
}

interface Reference {
  id: string;
  type: 'gemara' | 'shulchan_aruch' | 'rambam' | 'mishna' | 'book';
  source: string;
  text: string;
  psakId: string;
  position: { start: number; end: number };
}
```

### src/utils/
- **psakUtils.ts** - ×¤×¨×¡×™× ×’, ×—×™×¤×•×©, ×¤×•×¨××˜ ×ª××¨×™×›×™×
- **smartReferences.ts** - ×–×™×”×•×™ ××§×•×¨×•×ª, ×‘× ×™×™×ª ××™× ×“×§×¡
- **sefaria.ts** - (××•×¤×¦×™×•× ×œ×™) ××™× ×˜×’×¨×¦×™×” ×¢× Sefaria

---

## ×§×•××¤×•× × ×˜×•×ª ×¢×™×§×¨×™×•×ª

### Sidebar (Main Navigation)
**Props**: 
```typescript
{ psakCount: number, onPinnedChange?: (isPinned: boolean) => void }
```

**State**:
- `isPinned` - ××•×¦××“ ××• ×œ×
- `isVisible` - × ×¨××” ××• ××•×¡×ª×¨ (auto)
- `isHovering` - ×¢×›×‘×¨ ××¢×œ ×”×¡×™×™×“×‘×¨

**Logic**:
- Mouse near right edge (50px) â†’ show
- Mouse far from sidebar (>320px) AND not hovering â†’ hide
- Pin button toggles isPinned
- Callback to App.tsx to adjust main margin

### EditingSidebar
**Props**:
```typescript
{
  fontSize: number,
  onFontSizeChange: (size: number) => void,
  lineHeight: number,
  onLineHeightChange: (height: number) => void,
  onTextStyle: (style) => void,
  onHighlight: (color: string) => void,
  onReset: () => void,
  isPinned?: boolean,
  onTogglePin?: () => void
}
```

**Functions**:
- Text styles: `document.execCommand('bold'/'italic'/...)`
- Highlight: wrap selection in `<span style="background: color">`
- Reset: restore original HTML from props

### NavigationSidebar
**Props**:
```typescript
{
  psak: PsakDin,
  onNavigate: (position: number) => void,
  onSourceClick: (source: string) => void,
  isPinned?: boolean,
  onTogglePin?: () => void
}
```

**Tabs**:
1. **Summary**: `psak.summary`
2. **TOC**: parsed from HTML headings
3. **Sources**: `psak.references` grouped by type

**Search**:
- Filter sources by query
- Case-insensitive Hebrew/English

### SelectionPopup
**Props**:
```typescript
{ containerRef: React.RefObject<HTMLDivElement> }
```

**Lifecycle**:
1. Listen to `selectionchange` event
2. Check if selection inside container
3. Calculate position (above or below)
4. Show popup
5. Apply styles with `document.execCommand`
6. Hide on click outside or selection collapsed

**Styles Applied**:
- Text: bold, italic, underline, strikethrough, superscript, subscript
- Background: 8 colors
- Text color: 6 colors
- Copy, Clear formatting

---

## ×”×ª×§× ×” ×•×”×¨×¦×”

### ×“×¨×™×©×•×ª ××§×“×™××•×ª
- Node.js 18+
- npm ××• yarn

### ×”×ª×§× ×”
```bash
cd psak-din-app
npm install
```

### ×”×¨×¦×” ×‘×¤×™×ª×•×—
```bash
npm run dev
```
â†’ ×¤×ª×— ×“×¤×“×¤×Ÿ ×‘-`http://localhost:3000`

### ×‘× ×™×™×” ×œ×™×™×¦×•×¨
```bash
npm run build
```
â†’ ×§×‘×¦×™× ×‘-`dist/`

### Preview ×©×œ build
```bash
npm run preview
```

---

## ×¤×™×¦'×¨×™× ××ª×§×“××™×

### 1. localStorage Persistence
×›×œ ×¤×¡×§ × ×©××¨ ×¢×:
- ×”×ª×•×›×Ÿ ×”××œ×
- ×”×¢×“×¤×•×ª ×¢×™×¦×•×‘ ×œ×¤×™ ×¤×¡×§
- ×§××© ×©×œ ××§×•×¨×•×ª ××¡×¤×¨×™×
- ××¦×‘ ×¡×™×™×“×‘×¨ (pinned/hidden)

### 2. Smart Caching
- ×¤×¡×§×™ ×“×™×Ÿ: ×©××™×¨×” ××—×ª ×‘×¢×ª ×”×¢×œ××”
- ××§×•×¨×•×ª Sefaria: ×§××© ×œ×›×œ ×‘×§×©×”
- ×¤×•×¨××˜: `source-cache-${encodedSource}`

### 3. Hebrew Date Formatting
```javascript
formatHebrewDate(date) â†’ "×—×³ ×‘×©×‘×˜ ×ª×©×¤×´×•"
```
- ×”××¨×” ×œ×•×¢×–×™ â† ×¢×‘×¨×™
- ×¤×•×¨××˜ ×™×¤×” ×œ×ª×¦×•×’×”

### 4. Responsive Design
- Mobile: 1 ×¢××•×“×”
- Tablet: 2 ×¢××•×“×•×ª
- Desktop: 3 ×¢××•×“×•×ª
- ×’×¨×™×“ ×“×™× ××™ ×¢× Tailwind

### 5. Color Scheme
```javascript
colors: {
  navy: { 900: '#1e293b', 800: '#334155', 950: '#0f172a' },
  gold: { 400: '#eab308', 500: '#d97706', 600: '#c2410c' },
  cream: { 100: '#fef9e7', 200: '#fcf4dd' },
  mouse: { 100: '#f5f5f5', 400: '#9ca3af', 600: '#4b5563' }
}
```

### 6. Animations
- `animate-fade-in` - ×”×•×¤×¢×” ×¢×“×™× ×”
- `transition-all duration-300` - ××¢×‘×¨×™× ×—×œ×§×™×
- `hover:scale-110` - ×–×•× ×‘×”×•×‘×¨
- `animate-pulse` - ×¤×¢×™××” ×œ×”×“×’×©×”

### 7. Security
- DOMPurify ×œ× ×™×§×•×™ HTML
- `suppressContentEditableWarning` ×œ-React
- Sanitize user input ×‘×—×™×¤×•×©

### 8. Performance
- `useMemo` ×œ×—×™×©×•×‘×™× ×›×‘×“×™×
- `useCallback` ×œ×× ×™×¢×ª re-renders
- Lazy loading ×©×œ ××§×•×¨×•×ª
- Virtual scrolling (×™×›×•×œ ×œ×”×•×¡×™×£)

---

## ×˜×™×¤×™× ×œ××¤×ª×—×™×

### ×”×•×¡×¤×ª ××§×•×¨ ×—×“×©
1. ×”×•×¡×£ regex ×‘-`smartReferences.ts`:
```javascript
const pattern = /your-pattern/g;
```
2. ×”×•×¡×£ parser ×‘-`parseSourceToSefaria`
3. ×”×•×¡×£ type ×‘-`Reference` interface

### ×”×•×¡×¤×ª ×ª×¦×•×’×” ×—×“×©×”
1. ×”×•×¡×£ ×‘-`PsakimList.tsx`:
```typescript
type ViewMode = 'grid' | 'table' | 'compact' | 'list' | 'YOUR_NEW_VIEW';
```
2. ×¦×•×¨ JSX ×œ××¦×‘ ×”×—×“×©
3. ×”×•×¡×£ ×›×¤×ª×•×¨ ×‘-`viewModes` array

### ×©×™× ×•×™ ×¢×™×¦×•×‘
1. ×¢×¨×•×š `tailwind.config.js`
2. ×”×•×¡×£ ×¦×‘×¢×™×/×¤×•× ×˜×™×
3. npm run dev ×™×¢×“×›×Ÿ ××•×˜×•××˜×™×ª

### Debug
- React DevTools ×œ×”×¡×ª×›×œ×•×ª ×¢×œ state
- Console logs ×‘×›×œ ×©×œ×‘
- localStorage ×¤×ª×•×— ×‘-DevTools â†’ Application

---

## ×¨×™×©×™×•×Ÿ
MIT License - ×©×™××•×© ×—×•×¤×©×™

## ×ª××™×›×”
×œ×©××œ×•×ª ×•×ª××™×›×”, ×¤× ×” ×œ××¤×ª×—.

---

**×’×¨×¡×”**: 1.0.0  
**×ª××¨×™×š**: 2026-01-10  
**××¤×ª×—**: GitHub Copilot + AI Assistant  
**×©×¤×•×ª**: TypeScript, Hebrew (RTL)  

ğŸ‰ **Happy Coding!** ğŸ‰
